WHITESPACE = _{ " " | "\t" | NEWLINE }

number = @{ ASCII_DIGIT+ }
ident = { ASCII_ALPHA+ }
string = ${ "\"" ~ inner ~ "\"" }
inner = @{ char* }
char = {
    !("\"" | "\\" | NEWLINE) ~ ANY
    | "\\" ~ ("\"" | "\\" | "/" | "b" | "f" | "n" | "r" | "t")
    | "\\" ~ ("u" ~ ASCII_HEX_DIGIT{4})
}
call = { ident ~ "(" ~ (logic ~ ("," ~ logic)*)? ~ ")" }

PLUS = @{ "+" }
MINUS = @{ "-" }
STAR = @{ "*" }
SLASH = @{ "/" }
PERCENT = @{ "%" }
BANG = @{ "!" }

expr = { term ~ ((PLUS | MINUS) ~ term)* }
term = { factor ~ ((STAR | SLASH | PERCENT) ~ factor)* }
factor = { ((MINUS | BANG) ~ primary) | primary }
primary = { "(" ~ logic ~ ")" | call | number | ident | string }

GT = @{ ">" }
LT = @{ "<" }
EQ = @{ "==" }
NE = @{ "!=" }
GTE = @{ ">=" }
LTE = @{ "<=" }

comparison_op = { GT | LT | EQ | NE | GTE | LTE }
comparison = { expr ~ (comparison_op ~ expr)* }

AND = @{ "&&" }
OR = @{ "||" }
logical_op = { AND | OR }
logic = { comparison ~ (logical_op ~ comparison)* }

let_stmt = { "let" ~ ident ~ "=" ~ logic }
assign_stmt = { ident ~ "=" ~ logic }
return_stmt = { "return" ~ logic? }

fn_def = { "fn" ~ ident ~ "(" ~ (ident ~ ("," ~ ident)*)? ~ ")" ~ "{" ~ stmt* ~ "}" }

stmt = { (let_stmt | assign_stmt | return_stmt | comparison) ~ ";" }
prog = _{ (fn_def | stmt)* }
